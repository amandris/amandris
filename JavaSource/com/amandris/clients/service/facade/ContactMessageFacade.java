package com.amandris.clients.service.facade;import java.util.GregorianCalendar;import java.util.Locale;import com.amandris.clients.service.dao.ContactDAO;import com.amandris.clients.service.dao.ContactMessageDAO;import com.amandris.clients.service.vo.Contact;import com.amandris.clients.service.vo.ContactMessage;import com.amandris.clients.util.ConfigurationParameterManager;import com.amandris.clients.util.DBUtils;import com.amandris.clients.util.exception.DataAccessErrorException;import com.amandris.clients.util.exception.DataUpdateErrorException;import com.amandris.clients.util.mail.ContactMessageMailObject;import com.amandris.clients.util.mail.Mail;import com.amandris.clients.web.form.ContactMessageForm;public class ContactMessageFacade {		public boolean setContactMessage( ContactMessageForm contactMessageForm, Integer userId, boolean fromBuyerToSeller, boolean sendMail, Locale locale) throws DataAccessErrorException, DataUpdateErrorException	{		ContactMessageDAO			contactMessageDAO			= new ContactMessageDAO();		ContactDAO					contactDAO					= new ContactDAO();		ContactMessage				contactMessage				= new ContactMessage();		Contact						contact						= null;		ContactMessageMailObject 	contactMessageMailObject 	= new ContactMessageMailObject( locale);		String						text						= "";				contact = contactDAO.getContactById( DBUtils.parseInteger( contactMessageForm.getContactId(), 0));				if( contact == null)			return false;				if( fromBuyerToSeller == true) {			if( contact.getBuyerId().intValue() != userId.intValue())				return false;		} else {			if( contact.getSellerId().intValue() != userId.intValue())				return false;		}				contactMessage.setContact		( contact);		contactMessage.setContactId		( contact.getId());		contactMessage.setDate			( GregorianCalendar.getInstance( locale).getTime());		contactMessage.setIsNew			( new Integer( 1));		contactMessage.setSentFromBuyer	( DBUtils.boolean2Integer( fromBuyerToSeller));		contactMessage.setText			( contactMessageForm.getText());				contactMessageDAO.setContactMessage( contactMessage);						if( sendMail) {			contactMessageMailObject.setDate				( DBUtils.getDate( contact.getDateDate(), 4));			contactMessageMailObject.setBuyer				( contact.getBuyer());			contactMessageMailObject.setSeller				( contact.getSeller());			contactMessageMailObject.setFromBuyerToSeller	( fromBuyerToSeller);			contactMessageMailObject.setText				( contactMessage.getText());			contactMessageMailObject.setLocale				( locale);						if( fromBuyerToSeller) {				text = ConfigurationParameterManager.getMessages().getMessage( locale, "contactMessageMailObject.subject1", contact.getSeller().getLogin(), contact.getBuyer().getLogin());				Mail.sendMail( contact.getSeller().getEmail(), text, contactMessageMailObject);			} else {				text = ConfigurationParameterManager.getMessages().getMessage( locale, "contactMessageMailObject.subject2", contact.getBuyer().getLogin(), contact.getSeller().getLogin());				Mail.sendMail( contact.getBuyer().getEmail(), text, contactMessageMailObject);			}		}				return true;	}		public boolean setContactMessageToBuyer( Integer contactId, Integer sellerId, String text, Locale locale) throws DataAccessErrorException, DataUpdateErrorException	{		ContactMessageDAO	contactMessageDAO	= new ContactMessageDAO();		ContactDAO			contactDAO			= new ContactDAO();		ContactMessage		contactMessage		= new ContactMessage();		Contact				contact				= null;				contact = contactDAO.getContactById( contactId);				if( contact == null)			return false;				if( contact.getSellerId().intValue() != sellerId.intValue())			return false;				contactMessage.setContact		( contact);		contactMessage.setContactId		( contact.getId());		contactMessage.setDate			( GregorianCalendar.getInstance( locale).getTime());		contactMessage.setIsNew			( new Integer( 1));		contactMessage.setText			( text);				contactMessage.setSentFromBuyer	( new Integer( 0));				contactMessageDAO.setContactMessage( contactMessage);				return true;	}			public boolean setContactMessageToSeller( Integer contactId, Integer buyerId, String text, Locale locale) throws DataAccessErrorException, DataUpdateErrorException	{		ContactMessageDAO	contactMessageDAO	= new ContactMessageDAO();		ContactDAO			contactDAO			= new ContactDAO();		ContactMessage		contactMessage		= new ContactMessage();		Contact				contact				= null;				contact = contactDAO.getContactById( contactId);				if( contact == null)			return false;				if( contact.getBuyerId().intValue() != buyerId.intValue())			return false;				contactMessage.setContact		( contact);		contactMessage.setContactId		( contact.getId());		contactMessage.setDate			( GregorianCalendar.getInstance( locale).getTime());		contactMessage.setIsNew			( new Integer( 1));		contactMessage.setText			( text);		contactMessage.setSentFromBuyer	( new Integer( 1));		contactMessageDAO.setContactMessage( contactMessage);				return true;	}	}